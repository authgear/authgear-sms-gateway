name: Pass
error: null
config:
  providers:
    - name: twilio
      type: twilio
      twilio:
        account_sid: "my-account-sid"
        auth_token: "my-auth-token"
        message_service_sid: "my-message-service-sid"
        from: "+85212345678"
    - name: accessyou
      type: accessyou
      accessyou:
        accountno: "my-accountno"
        user: "my-user"
        pwd: "my-pwd"
        from: "my-sender"
    - name: sendcloud
      type: sendcloud
      sendcloud:
        sms_user: "my-sms-user"
        sms_key: "my-sms-key"
        templates:
          - template_id: "919888"
            template_msg_type: "2"
          - template_id: "919879"
            template_msg_type: "2"
        template_assignments:
          - authgear_template_name: "verficiation_sms.txt"
            default_template_id: "919888"
            by_languages:
              - authgear_languag: en
                template_id: "919888"
  provider_selector:
    switch:
      - type: match_app_id_and_phone_number_alpha2
        use_provider: accessyou
        phone_number_alpha2: HK
        app_id: "123"
      - type: match_app_id_and_phone_number_alpha2
        use_provider: sendcloud
        phone_number_alpha2: CN
        app_id: "123"
      - type: match_phone_number_alpha2
        use_provider: accessyou
        phone_number_alpha2: HK
      - type: match_phone_number_alpha2
        use_provider: sendcloud
        phone_number_alpha2: CN
      - type: default
        use_provider: twilio
---
name: failed-provider-type
error: |-
  invalid configuration:
  /providers/0/type: enum
    map[actual:twillio expected:[twilio accessyou sendcloud]]
config:
  providers:
    - name: twilio
      type: twillio
      twilio:
        account_sid: "my-account-sid"
        auth_token: "my-auth-token"
        message_service_sid: "my-message-service-sid"
        from: "my-sender"
  provider_selector:
    switch:
      - type: match_phone_number_alpha2
        use_provider: accessyou
        phone_number_alpha2: HK
      - type: default
        use_provider: infobip
---
name: failed-missing-provider
error: |-
  invalid configuration:
  /provider_selector/switch/0/use_provider: provider accessyou not found
  /provider_selector/switch/1/use_provider: provider infobip not found
config:
  providers:
    - name: twilio
      type: twilio
      twilio:
        account_sid: "my-account-sid"
        auth_token: "my-auth-token"
        message_service_sid: "my-message-service-sid"
        from: "my-sender"
  provider_selector:
    switch:
      - type: match_phone_number_alpha2
        use_provider: accessyou
        phone_number_alpha2: HK
      - type: default
        use_provider: infobip
---
name: failed-provider-selector-missing-default
error: |-
  invalid configuration:
  /provider_selector/switch: provider selector default not found
config:
  providers:
    - name: twilio
      type: twilio
      twilio:
        account_sid: "my-account-sid"
        auth_token: "my-auth-token"
        message_service_sid: "my-message-service-sid"
        from: "+85212345678"
    - name: accessyou
      type: accessyou
      accessyou:
        accountno: "my-accountno"
        user: "my-user"
        pwd: "my-pwd"
        from: "my-sender"
    - name: sendcloud
      type: sendcloud
      sendcloud:
        sms_user: "my-sms-user"
        sms_key: "my-sms-key"
        templates:
          - template_id: "919888"
            template_msg_type: "2"
          - template_id: "919879"
            template_msg_type: "2"
        template_assignments:
          - authgear_template_name: "verficiation_sms.txt"
            default_template_id: "919888"
            by_languages:
              - authgear_languag: en
                template_id: "919888"
  provider_selector:
    switch:
      - type: match_app_id_and_phone_number_alpha2
        use_provider: accessyou
        phone_number_alpha2: HK
        app_id: "123"
      - type: match_app_id_and_phone_number_alpha2
        use_provider: sendcloud
        phone_number_alpha2: CN
        app_id: "123"
      - type: match_phone_number_alpha2
        use_provider: accessyou
        phone_number_alpha2: HK
      - type: match_phone_number_alpha2
        use_provider: sendcloud
        phone_number_alpha2: CN
---
name: failed-sendcloud-config
error: |-
  invalid configuration:
  /providers/2/sendcloud/template_assignments/0/default_template_id: template_id 919889 not found
  /providers/2/sendcloud/template_assignments/0/by_languages/0/template_id: template_id 919890 not found
config:
  providers:
    - name: twilio
      type: twilio
      twilio:
        account_sid: "my-account-sid"
        auth_token: "my-auth-token"
        message_service_sid: "my-message-service-sid"
        from: "+85212345678"
    - name: accessyou
      type: accessyou
      accessyou:
        accountno: "my-accountno"
        user: "my-user"
        pwd: "my-pwd"
        from: "my-sender"
    - name: sendcloud
      type: sendcloud
      sendcloud:
        sms_user: "my-sms-user"
        sms_key: "my-sms-key"
        templates:
          - template_id: "919888"
            template_msg_type: "2"
          - template_id: "919879"
            template_msg_type: "2"
        template_assignments:
          - authgear_template_name: "verficiation_sms.txt"
            default_template_id: "919889"
            by_languages:
              - authgear_languag: en
                template_id: "919890"
  provider_selector:
    switch:
      - type: match_app_id_and_phone_number_alpha2
        use_provider: accessyou
        phone_number_alpha2: HK
        app_id: "123"
      - type: match_app_id_and_phone_number_alpha2
        use_provider: sendcloud
        phone_number_alpha2: CN
        app_id: "123"
      - type: match_phone_number_alpha2
        use_provider: accessyou
        phone_number_alpha2: HK
      - type: match_phone_number_alpha2
        use_provider: sendcloud
        phone_number_alpha2: CN
      - type: default
        use_provider: twilio
